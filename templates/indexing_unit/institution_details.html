{% extends 'indexing_unit/dashboard_base1.html'%}
{% load static %}
{% block title %}Indexing Unit | {{ block.super }}{% endblock title %}

{% block content %}
<div class="container-fluid py-4">
<div class="row ml-3 mb-3">
<div class="col-lg-12 col-xl-9">
<div class="card">
<div class="card-header profile-tabs pb-0">
<ul class="nav nav-tabs">
<li class="nav-item">
<a class="nav-link active" href="#institution-profile" data-toggle="tab" aria-expanded="false"><i class="ti-user mr-2"></i>Institution Profile Details</a>
</li>

{% if object.get_indexing_officer_profile_qs %}
<li class="nav-item">
<a class="nav-link" href="#indexing-officers" data-toggle="tab" aria-expanded="false"><i class="ti-image mr-2"></i>Indexing Officers</a>
</li>
{% endif %}
</ul>
</div>
<div class="card-body">


<div class="">
<div class="tab-content">
<div class="tab-pane active" id="institution-profile">
<div class="row justify-content-center">
{% include 'partials/_alerts.html' %} 



<div class="col-md-12  profile-detail">
<div class="d-flex justify-content-between align-items-center">
 <div class="w-50">

<h5 class="mb-0 pb-2"> <i class="fas fa-school text-primary"></i> Institution Details </h5>
</div> 
</div>
<!-- <div class="col-md-12 alert alert-primary mt-1 mb-3 py-2" role="alert">
<h4 class="alert-heading font-18">Kindly review both admission and payment details before approving or rejecting application</h4>
</div> -->
</div>
<div class="col-md-7 mt-0">
<!-- <h5 class="mb-1"> <i class="fas fa-tv text-primary"></i> Basic Details</h5> -->
<div>  
<p class="text-sm mb-0">
<ul class="list-unstyled">                        
<li>Name of Institution: <span class="text-dark font-weight-bold ms-sm-2">{{object.name}}</span></li>
<li>Address: <span class="text-dark font-weight-bold ms-sm-2">{{object.address}}</span></li>
<li>Phone No: <span class="text-dark font-weight-bold ms-sm-2">{{object.phone_no}}</span></li>
<li>Email: <span class="text-dark font-weight-bold ms-sm-2">{{object.email}}</span></li>
<li>Institution Type: <span class="text-dark font-weight-bold ms-sm-2">{{object.institution_type}}</span></li>
<li>Course Type: <span class="text-dark font-weight-bold ms-sm-2">{{object.course_type}}</span></li>
<li>Date Created: <span class="text-dark font-weight-bold ms-sm-2">{{object.timestamp}}</span></li>
</ul>
 </div>


<h5 class="mb-1"> <i class="fab fa-accusoft text-primary"></i> Accreditation Details</h5> 
<div>  
<p class="text-sm mb-0">
<ul class="list-unstyled">                           
<li>Accreditation Date: <span class="text-dark font-weight-bold ms-sm-2">{{object.accreditation_date}}</span></li>
<li>Accreditation Score: <span class="text-dark font-weight-bold ms-sm-2">{{object.accreditation_score}}</span></li>
<li>Accreditation Type: <span class="text-dark font-weight-bold ms-sm-2">{{object.accreditation_type}}</span></li>
<li>Accreditation Due Date: <span class="text-dark font-weight-bold ms-sm-2">{{object.accreditation_due_date}}</span></li>
</ul>
 </div>
</div>


<div class="col-md-5 mt-0">
</div>
</div>
</div>


<div class="tab-pane" id="indexing-officers">

<div class="row justify-content">
{% include 'partials/_alerts.html' %} 
<div class="col-md-12  profile-detail">
<div class="d-flex justify-content-between align-items-center">
<div class="w-50">

<h5 class="mb-0 pb-2"> <i class="fas fa-user-friends text-primary"></i> Indexing Officers Details </h5>
</div> 


</div>
<!-- <div class="col-md-12 alert alert-primary mt-1 mb-3 py-2" role="alert">
<h4 class="alert-heading font-18">Kindly review both admission and payment details before approving or rejecting application</h4>
</div> -->
</div>
{% if object.get_indexing_officer_profile_qs %}
{% for object in object.get_indexing_officer_profile_qs %}
<div class="col-md-7 mt-0">
<!-- <h5 class="mb-1"> <i class="fa fa-graduation-cap text-primary"></i> Basic Details</h5> -->
<div>  
<p class="text-sm mb-0">
<ul class="list-unstyled">                           
<li>Name of Indexing Officer: <span class="text-dark font-weight-bold ms-sm-2">{{ object.indexing_officer.last_name }} {{ object.indexing_officer.first_name }}</span></li>
<li>Email: <span class="text-dark font-weight-bold ms-sm-2">{{ object.indexing_officer.email }}</span></li>
<li>Phone No: <span class="text-dark font-weight-bold ms-sm-2">{{ object.indexing_officer.phone_no }}</span></li>
</ul>
</div>
</div>
{% endfor %}
{% endif %}

</div>
</div>
<hr>

<div class="d-flex justify-content-end">   

<!-- <a href="{% url 'indexing_unit:delete_institution' object.slug %}" 
   class="btn btn-outline-danger py-0 mr-4 mt-1 mb-3">
   <i class="fa fa-trash" aria-hidden="true"></i> Delete Institution
</a> -->
<button 
  class="btn btn-outline-danger py-0 mr-4 mt-1 mb-3"
  onclick="confirmDelete('{{ object.slug }}', '{{ object.name }}')">
  <i class="fa fa-trash" aria-hidden="true"></i> Delete Institution
</button>

<script>
function confirmDelete(slug, name) {
  Swal.fire({
    title: 'Are you sure?',
    text: `Delete institution "${name}"? This action cannot be undone and will delete all indexing officers, students and users associated with this institution.`,
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#d33',
    cancelButtonColor: '#3085d6',
    confirmButtonText: 'Yes, delete it!'
  }).then((result) => {
    if (result.isConfirmed) {
      fetch(`/indexing_unit/${slug}/delete_institution/`, {
        method: 'DELETE',
        headers: {
          'X-CSRFToken': '{{ csrf_token }}',
          'Accept': 'application/json'
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          Swal.fire('Deleted!', `${name} was deleted successfully.`, 'success');
          setTimeout(() => {
            window.location.href = data.redirect_url;
          }, 1500);
        } else {
          Swal.fire('Error', data.error || 'Unable to delete institution.', 'error');
        }
      })
      .catch(() => Swal.fire('Error', 'Something went wrong.', 'error'));
    }
  });
}
</script>





<a href="{% url 'indexing_unit:update_institution' object.slug  %}" class="btn btn-outline-primary py-0 mr-4 mt-1 mb-3"><i class="fa fa-toggle-on" aria-hidden="true"></i> Update Institution</a>  


<a href="{% url 'indexing_unit:institutions_list' %}" class="btn btn-outline-primary py-0 mt-1 mb-3"><i class="fa fa-angle-double-left" aria-hidden="true"></i> Institutions List</a>  
</div>


</div>

</div>

</div>


</div>
</div>
</div>


{% endblock content %}
